{"ast":null,"code":"import { BehaviorSubject, catchError, tap, throwError } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthService {\n  constructor(http) {\n    this.http = http;\n    this.registerUrl = 'http://localhost:8080/api/v1/auth/register';\n    this.authenticationUrl = `http://localhost:8080/api/v1/auth/authenticate`;\n    this.tokenSubject = new BehaviorSubject(\"\");\n    this.loggedIn = new BehaviorSubject(false);\n    const storedToken = localStorage.getItem('token');\n    console.log(\"storedToken: \" + storedToken);\n    if (storedToken) {\n      this.validateToken(storedToken).subscribe(isValid => {\n        if (isValid) {\n          this.tokenSubject.next(storedToken);\n          this.loggedIn.next(true);\n        }\n      });\n    }\n  }\n  validateToken(token) {\n    // Backend endpoint to validate token\n    return this.http.post('http://localhost:8080/api/v1/auth/validate', {\n      token\n    });\n  }\n  register(user) {\n    return this.http.post(this.registerUrl, user).pipe(tap(response => {\n      if (response.access_token && response) {\n        this.saveToken(response.token);\n      }\n    }));\n  }\n  login(email, password) {\n    return this.http.post(this.authenticationUrl, {\n      email,\n      password\n    }).pipe(map(response => {\n      const token = response.access_token;\n      if (token) {\n        this.saveToken(token);\n        this.tokenSubject.next(token);\n        this.loggedIn.next(true);\n      }\n      return response;\n    }), catchError(error => {\n      // Handle error and return a user-friendly message or rethrow\n      console.error('Login failed', error);\n      return throwError(() => new Error('Login failed'));\n    }));\n  }\n  saveToken(token) {\n    localStorage.setItem('token', token);\n  }\n  getTokens() {\n    return this.tokenSubject.asObservable();\n  }\n  getToken() {\n    return this.tokenSubject.getValue();\n  }\n  refreshToken() {\n    // This URL and the request body might vary based on your backend implementation\n    return this.http.post('http://localhost:8080/api/v1/auth/refresh-token', {\n      refreshToken: this.getRefreshToken()\n    }).pipe(map(response => {\n      const token = response.access_token;\n      if (token) {\n        this.saveToken(token);\n        this.tokenSubject.next(token);\n      }\n      return response;\n    }));\n  }\n  getRefreshToken() {\n    // Assuming the refresh token is stored in local storage (or use a different method)\n    return localStorage.getItem('token');\n  }\n  logout() {\n    // Remove token from local storage and set subject to null\n    localStorage.removeItem('token');\n    this.tokenSubject.next(\"\");\n    this.loggedIn.next(false);\n  }\n  setLoggedIn(value) {\n    this.loggedIn.next(value);\n  }\n  isLoggedIn() {\n    return this.loggedIn.asObservable();\n  }\n  static #_ = this.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","catchError","tap","throwError","map","AuthService","constructor","http","registerUrl","authenticationUrl","tokenSubject","loggedIn","storedToken","localStorage","getItem","console","log","validateToken","subscribe","isValid","next","token","post","register","user","pipe","response","access_token","saveToken","login","email","password","error","Error","setItem","getTokens","asObservable","getToken","getValue","refreshToken","getRefreshToken","logout","removeItem","setLoggedIn","value","isLoggedIn","_","i0","ɵɵinject","i1","HttpClient","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\DRAGISA\\projects\\rent-a-car\\rent-a-car-frontend\\src\\app\\service\\auth.service.ts"],"sourcesContent":["import {Injectable} from '@angular/core';\nimport {HttpClient} from '@angular/common/http';\nimport {BehaviorSubject, catchError, Observable, tap, throwError} from 'rxjs';\nimport {map} from 'rxjs/operators';\nimport {User} from \"../model/user\";\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class AuthService {\n    private registerUrl = 'http://localhost:8080/api/v1/auth/register';\n    private authenticationUrl = `http://localhost:8080/api/v1/auth/authenticate`;\n    private tokenSubject: BehaviorSubject<string> = new BehaviorSubject<string>(\"\");\n    private loggedIn = new BehaviorSubject<boolean>(false);\n\n    constructor(private http: HttpClient) {\n        const storedToken = localStorage.getItem('token');\n      console.log(\"storedToken: \" + storedToken);\n        if (storedToken) {\n            this.validateToken(storedToken).subscribe(isValid => {\n                if (isValid) {\n                    this.tokenSubject.next(storedToken);\n                    this.loggedIn.next(true);\n                }\n            });\n        }\n    }\n\n    private validateToken(token: string): Observable<boolean> {\n        // Backend endpoint to validate token\n        return this.http.post<boolean>('http://localhost:8080/api/v1/auth/validate', { token });\n    }\n\n    register(user: any): Observable<any> {\n        return this.http.post(this.registerUrl, user)\n            .pipe(\n                tap((response: any) => {\n                    if (response.access_token && response) {\n                        this.saveToken(response.token);\n                    }\n                })\n            );\n    }\n\n    login(email: string, password: string): Observable<any> {\n        return this.http.post<any>(this.authenticationUrl, {email, password})\n            .pipe(\n                map(response => {\n                    const token = response.access_token;\n                    if (token) {\n                        this.saveToken(token);\n                        this.tokenSubject.next(token);\n                        this.loggedIn.next(true);\n                    }\n                    return response;\n                }),\n                catchError(error => {\n                    // Handle error and return a user-friendly message or rethrow\n                    console.error('Login failed', error);\n                    return throwError(() => new Error('Login failed'));\n                })\n            );\n    }\n\n    saveToken(token: string): void {\n        localStorage.setItem('token', token);\n    }\n\n    getTokens(): Observable<string> {\n        return this.tokenSubject.asObservable();\n    }\n\n    getToken(): string {\n        return this.tokenSubject.getValue();\n    }\n\n    refreshToken(): Observable<any> {\n        // This URL and the request body might vary based on your backend implementation\n        return this.http.post<any>('http://localhost:8080/api/v1/auth/refresh-token', {\n            refreshToken: this.getRefreshToken()\n        }).pipe(\n            map(response => {\n                const token = response.access_token;\n                if (token) {\n                    this.saveToken(token);\n                    this.tokenSubject.next(token);\n                }\n                return response;\n            })\n        );\n    }\n\n    private getRefreshToken(): any {\n        // Assuming the refresh token is stored in local storage (or use a different method)\n        return localStorage.getItem('token');\n    }\n\n\n    logout(): void {\n        // Remove token from local storage and set subject to null\n        localStorage.removeItem('token');\n        this.tokenSubject.next(\"\");\n        this.loggedIn.next(false);\n    }\n\n    setLoggedIn(value: boolean) {\n        this.loggedIn.next(value);\n    }\n\n    isLoggedIn(): Observable<boolean> {\n        return this.loggedIn.asObservable();\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}